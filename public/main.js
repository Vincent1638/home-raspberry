(()=>{"use strict";class e{}function t(e,t,s,a){const i=document.createElement("div"),n=c("label",{},e),l=c("div",{class:"select input "+s,"data-type":a,"data-selected":""}),o=c("div",{class:"option selectedOption"},t),d=c("div",{class:"arrow"},"▿");return l.append(o,d),i.append(n,l),i}function s(e,t,s=!1,a=!1,i={}){const n=c("div",{class:s?"options multiple":"options"}),l=c("div",{class:"option disabled","data-value":"none",style:"Set Brightness"!=e?"pointer-events: none":""},e);n.appendChild(l);for(let e in t){const l=c("div",{class:"option",style:a?"padding-left: 30px;":"","data-value":e},t[e]);(s||a)&&l.appendChild(c("div",{class:a?"image":"check"},a?i[e].svg:"")),n.appendChild(l)}return n}function a(e,t,s=[""]){const a=document.createElement("div"),i=c("label",{},e),n=c("input",{class:"input "+s,type:"text",placeholder:t});return a.append(i,n),a}function i(){const e=c("div",{class:"panel"}),t=c("div",{class:"row",id:"trigger"}),s=c("input",{type:"text",value:"Animation Sequence",readonly:"",style:"margin: 10px 0;"});return e.append(t,s),e}function n(){const e=c("div",{id:"sequence"}),t=c("div",{style:"margin-top: 10px;"}),s=c("button",{class:"button",id:"addEntry"},"Add");return t.appendChild(s),e.appendChild(t),e}function l(){const e=c("div",{class:"entryContainer"}),t=c("div",{class:"removeButton",id:"removeButton"});t.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path d="M193.94 256L296.5 153.44l21.15-21.15c3.12-3.12 3.12-8.19 0-11.31l-22.63-22.63c-3.12-3.12-8.19-3.12-11.31 0L160 222.06 36.29 98.34c-3.12-3.12-8.19-3.12-11.31 0L2.34 120.97c-3.12 3.12-3.12 8.19 0 11.31L126.06 256 2.34 379.71c-3.12 3.12-3.12 8.19 0 11.31l22.63 22.63c3.12 3.12 8.19 3.12 11.31 0L160 289.94 262.56 392.5l21.15 21.15c3.12 3.12 8.19 3.12 11.31 0l22.63-22.63c3.12-3.12 3.12-8.19 0-11.31L193.94 256z"></path></svg>';const s=document.createElement("div"),a=c("div",{class:"row",id:"entry"});return s.appendChild(a),e.append(t,s),e}function c(e,t={},s){const a=document.createElement(e);for(let e in t)a.setAttribute(e,t[e]);return s&&(a.innerHTML=s),a}class o extends e{constructor(e,t,s,a){super(),this.devices=t,this.layout=s,this.images=a,this.ws=e}setHtml(){let e;this.container=c("div",{class:"container",id:"active"}),this.disabledContainer=c("div",{class:"container disabled",id:"disabled"}),this.cards=[],this.cards=this.devices.map((e=>{const t=this.createCard(e);return this.updateCard(t,e),t})),this.sortCards(),document.addEventListener("dragover",(e=>e.preventDefault())),document.addEventListener("dragend",(e=>e.target.style.opacity="1")),document.addEventListener("dragstart",(t=>{s.innerHTML=t.target.innerHTML,s.style.width=t.target.offsetWidth-12+"px",t.dataTransfer.setDragImage(s,t.target.offsetWidth/2,t.target.offsetHeight/2),e=t.target,t.target.style.opacity="0"}),!1),document.addEventListener("dragenter",(t=>{if(t.target.classList.contains("card")){const s=t.target.parentNode;s.isSameNode(e.parentNode)&&2===t.target.compareDocumentPosition(e)?s.insertBefore(e,t.target.nextSibling):s.insertBefore(e,t.target)}}));const t=c("div",{class:"content"});this.label=c("label",{style:"width: 300px;"},"100"),this.popover=c("div",{class:"popover",style:"visibility: hidden;"}),this.range=c("input",{type:"range",min:"0",max:"20"}),t.append(this.range,this.label),this.popover.appendChild(t),this.range.addEventListener("change",(()=>{0===parseInt(this.range.value)?this.ws.send(JSON.stringify({event:"setDevice",id:this.deviceId,state:!1,brightness:10})):this.ws.send(JSON.stringify({event:"setDevice",id:this.deviceId,state:!0,brightness:50*parseInt(this.range.value)}))})),this.range.addEventListener("input",(()=>{this.updateBrightness(5*parseInt(this.range.value))}));const s=c("div",{class:"card",style:"position: absolute; top: -100px; left: -500px;"}),a=document.createDocumentFragment();return a.append(this.container,this.disabledContainer,this.popover,s),a}createCard(e){const t=c("div",{class:"card",id:e.id,"data-type":e.type,draggable:!1});return t.style.animationDelay=-Math.random()+"s",t.append(c("div",{class:"image"},this.images[e.image].svg),c("div",{class:"name"},e.name),c("div",{class:"state"})),t}sortCards(){this.cards.sort(((e,t)=>this.layout.indexOf(e.id)-this.layout.indexOf(t.id))),this.cards.forEach((e=>{this.layout.includes(e.id)?this.container.appendChild(e):this.disabledContainer.appendChild(e)}))}updateBrightness(e){this.label.innerText=0===e?"Off":e+"%"}handleClick(e){if(!this.reorder&&e.classList.contains("card"))switch(e.dataset.type){case"button":this.ws.send(JSON.stringify({event:"updateButton",id:e.id}));break;case"garage":this.ws.send(JSON.stringify({event:"setGarage"}));break;case"switch":this.ws.send(JSON.stringify({event:"toggleSwitch",id:e.id}));break;case"multioutlet":case"outlet":case"dimmer":this.ws.send(JSON.stringify({event:"toggleDevice",id:e.id}))}else this.reorder&&!this.firstClick?(this.cards.forEach((e=>{e.classList.remove("reorder"),e.setAttribute("draggable","false")})),this.disabledContainer.classList.add("disabled"),this.reorder=!1,this.updateLayout()):e.classList.contains("popover")?(this.popover.style.opacity="0",this.popover.style.visibility="hidden"):this.firstClick=!1}handleLongClick(e){e.classList.contains("nav-header")?(this.cards.forEach((e=>{e.classList.add("reorder"),e.setAttribute("draggable","true")})),this.reorder=!0,this.firstClick=!0,this.disabledContainer.classList.remove("disabled")):this.reorder||"dimmer"!==e.dataset.type||(this.deviceId=e.id,this.range.value=e.dataset.value,this.updateBrightness(5*parseInt(e.dataset.value)),this.popover.style.visibility="visible",this.popover.style.opacity="1")}handleMessage(e){if(e.hasOwnProperty("type")){const t=document.getElementById(e.id);if(!t)return;this.updateCard(t,e)}}updateCard(e,t){switch(t.type){case"switch":case"outlet":case"multioutlet":e.classList.toggle("inactive",!t.state),e.lastElementChild.innerHTML=t.state?"On":"Off";break;case"dimmer":e.classList.toggle("inactive",!t.state),e.setAttribute("data-value",String(t.brightness/50)),e.lastElementChild.innerHTML=t.state?t.brightness/10+"%":"Off";break;case"garage":e.classList.toggle("inactive",!t.state),e.lastElementChild.innerHTML=t.data;break;case"door":e.classList.toggle("inactive",!t.state),e.lastElementChild.innerHTML=t.state?"Open":"Closed";break;case"button":e.classList.toggle("inactive",!0),e.lastElementChild.innerHTML="Connected";break;case"sensor":e.classList.toggle("inactive",!t.state),e.lastElementChild.innerHTML=t.state?"Active":t.data}}updateLayout(){const e=[];this.container.querySelectorAll(".card").forEach((t=>{e.push(t.id)})),this.layout=e,this.ws.send(JSON.stringify({event:"updateLayout",layout:e}))}}const d=class extends e{constructor(e,o,d,r){super(),this.automationsData=d,this.automations=o,this.dimmableDevices=r,this.ws=e;const h=c("div",{class:"expandButton",id:"expandAutomation"});h.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M441.9 167.3l-19.8-19.8c-4.7-4.7-12.3-4.7-17 0L224 328.2 42.9 147.5c-4.7-4.7-12.3-4.7-17 0L6.1 167.3c-4.7 4.7-4.7 12.3 0 17l209.4 209.4c4.7 4.7 12.3 4.7 17 0l209.4-209.4c4.7-4.7 4.7-12.3 0-17z"></path></svg>';const p=c("button",{class:"button solid save",id:"saveAutomations"},"Save");p.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" style="height: 16px; margin-right: 8px;" fill="#FFFFFF"><path d="M433.941 129.941l-83.882-83.882A48 48 0 0 0 316.118 32H48C21.49 32 0 53.49 0 80v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V163.882a48 48 0 0 0-14.059-33.941zM272 80v80H144V80h128zm122 352H54a6 6 0 0 1-6-6V86a6 6 0 0 1 6-6h42v104c0 13.255 10.745 24 24 24h176c13.255 0 24-10.745 24-24V83.882l78.243 78.243a6 6 0 0 1 1.757 4.243V426a6 6 0 0 1-6 6zM224 232c-48.523 0-88 39.477-88 88s39.477 88 88 88 88-39.477 88-88-39.477-88-88-88zm0 128c-22.056 0-40-17.944-40-40s17.944-40 40-40 40 17.944 40 40-17.944 40-40 40z"></path></svg>Save';const u=document.createElement("div");u.append(c("button",{class:"button solid",id:"addAutomation"},"Add Automation"),p),this.templates=[i(),n(),l(),c("div",{class:"condition"}),a("Time","00:00 - 24:00"),a("Time","Start Time"),a("Wait","Enter Delay"),a("Offset","None"),t("Device","Select Device",[],0),t("Device","Select Device",["tuyaSelect"],1),t("Trigger","Select Trigger",["selectTrigger"],2),t("Option","Select Option",["selectOption"],3),t("Brightness","Set Brightness",[],4),t("State","Select State Trigger",[],5),t("Condition","Select State",[],6),t("State","Select State",[],7),c("input",{type:"text",value:"Then",readonly:"",style:"margin: 10px 0;"}),c("input",{type:"text",value:"Else",readonly:"",style:"margin: 10px 0;"}),c("button",{class:"button",id:"removeAutomation"},"Remove Automation"),c("button",{class:"button",id:"enabledState"},"Enabled"),u,h],this.options=[s("Select Device",this.automationsData[0]),s("Select Device",this.automationsData[1],!0),s("Select Trigger",this.automationsData[2]),s("Select Option",this.automationsData[3]),s("Set Brightness",this.automationsData[4]),s("Select State Trigger",this.automationsData[5]),s("Select State",this.automationsData[6]),s("Select State",this.automationsData[7])]}setHtml(){const e=document.createDocumentFragment();this.container=document.createElement("div"),this.removedAutomations=[],this.automations.forEach((e=>{this.container.appendChild(this.loadAutomation(e))})),this.container.appendChild(this.templates[20].cloneNode(!0)),this.container.className="automation";const t=document.createElement("div");return t.append(...this.options),e.append(this.container,t),e}handleClick(e){switch(e.classList.contains("selectedOption")?(this.activeSelect=e.parentNode,this.openSelect(e.parentElement)):e.classList.contains("option")?this.handleSelectedOption(e):this.closeOpenSelect(),e.id){case"addEntry":const t=e.parentNode.parentNode;t.insertBefore(this.loadEntry(),t.lastChild);break;case"removeButton":e.parentNode.parentNode.removeChild(e.parentNode);break;case"enabledState":e.innerText=e.classList.toggle("disabled")?"Disabled":"Enabled";break;case"removeAutomation":const s=e.parentElement.parentElement.parentElement;""!==s.id&&this.removedAutomations.push(s.id),s.parentElement.removeChild(s);break;case"addAutomation":this.container.insertBefore(this.loadAutomation(),this.container.lastChild);break;case"saveAutomations":this.saveAutomations();break;case"expandAutomation":const a=e.classList.toggle("expanded");e.parentElement.parentElement.classList.toggle("expanded",a)}}handleLongClick(e){}handleMessage(e){}loadAutomation(e={id:null,trigger:{type:null},enabled:!0,sequence:[{type:null}]}){let t=this.templates[0].cloneNode(!0);e.id&&(t.id=String(e.id)),this.loadTrigger(t.firstElementChild,e.trigger),t.appendChild(this.loadSequence(e.sequence));const s=this.templates[19].cloneNode(!0);return e.enabled||null==e.enabled||(s.innerText="Disabled",s.classList.add("disabled")),t.lastElementChild.lastElementChild.classList.add("footer"),t.lastElementChild.lastElementChild.append(this.templates[18].cloneNode(!0),s,document.createElement("div"),this.templates[21].cloneNode(!0)),t}loadTrigger(e,t){return e.appendChild(this.createSelect(10,[t.type])),this.updateTrigger(e,t),e}updateTrigger(e,t){for(;e.lastChild!==e.firstChild;)e.removeChild(e.lastChild);switch(t.type){case"device":e.append(this.createSelect(8,[t.device]),this.createSelect(13,[this.parseBool(t.state)]),this.createTextField(4,t.time));break;case"time":e.append(this.createTextField(5,t.time));break;case"sunrise":case"sunset":e.append(this.createTextField(7,this.parseTime(t.offset)))}}loadSequence(e=[{type:null}]){const t=this.templates[1].cloneNode(!0);return 0===e.length&&t.insertBefore(this.loadEntry(e[0]),t.lastChild),e.forEach((e=>{t.insertBefore(this.loadEntry(e),t.lastChild)})),t}loadEntry(e={type:null}){let t=this.templates[2].cloneNode(!0);return this.updateEntry(t,e),t}updateEntry(e,t){const s=e.lastElementChild,a=e.lastElementChild.firstElementChild;for(a.appendChild(this.createSelect(11,[t.type]));a.lastChild!==a.firstChild;)a.removeChild(a.lastChild);for(;s.lastChild!==s.firstChild;)s.removeChild(s.lastChild);switch(t.type){case"device":const e=!t.device||!t.device.some((e=>this.dimmableDevices.includes(e)));a.append(this.createSelect(9,t.device),this.createSelect(15,[this.parseBool(t.state)]),this.createSelect(12,t.brightness?[t.brightness.toString()]:[],e));break;case"if":let i=this.templates[3].cloneNode(!0);i.append(this.createSelect(8,t.if?[t.if.device]:[void 0]),this.createSelect(14,t.if?[this.parseBool(t.if.state)]:[void 0])),a.appendChild(i),s.append(this.templates[16].cloneNode(!0),this.loadSequence(t.then));break;case"ifElse":let n=this.templates[3].cloneNode(!0);n.append(this.createSelect(8,t.if?[t.if.device]:[void 0]),this.createSelect(14,t.if?[this.parseBool(t.if.state)]:[void 0])),a.appendChild(n),s.append(this.templates[16].cloneNode(!0),this.loadSequence(t.then),this.templates[17].cloneNode(!0),this.loadSequence(t.else));break;case"wait":a.append(this.createTextField(6,this.parseTime(t.wait)))}}createSelect(e,t=[],s=!1){const a=this.templates[e].cloneNode(!0);s&&a.lastElementChild.classList.add("disabled");const i=a.lastElementChild.dataset.type;return null!=t[0]&&(a.lastChild.firstChild.innerText=t.map((e=>this.automationsData[i][e])).join(", "),a.lastChild.dataset.selected=t.join()),a}createTextField(e,t=""){const s=this.templates[e].cloneNode(!0);return s.lastChild.value=t,s}openSelect(e){this.closeOpenSelect();const t=e.dataset.selected.split(","),s=this.options[parseInt(e.dataset.type)];s.childNodes.forEach((e=>{t.includes(e.dataset.value)?e.classList.add("selected"):e.classList.remove("selected")})),s.classList.add("open");const a=e.getBoundingClientRect(),i=s.clientHeight,n=window.innerHeight-a.top;s.style.left=a.left+"px",s.style.width=e.offsetWidth+"px",s.style.maxHeight=window.innerHeight-78+"px",n<i?i<window.innerHeight?s.style.top=e.offsetTop+n-i-10+"px":s.style.top="68px":s.style.top=e.offsetTop+"px"}handleSelectedOption(e){const t=e.parentElement;if(t.classList.contains("multiple")){e.classList.toggle("selected");const s=t.querySelectorAll(".selected");let a=[];s.forEach((e=>{a.push(e.dataset.value)})),0===a.length?this.activeSelect.firstElementChild.innerHTML=t.firstElementChild.innerHTML:this.activeSelect.firstElementChild.innerHTML=a.map((e=>this.automationsData[this.activeSelect.dataset.type][e])).join(", "),this.activeSelect.dataset.selected=a.join(),this.updateRow(a)}else{if(!e.classList.contains("selected")){const s=t.querySelector(".selected");s&&s.classList.remove("selected"),e.classList.add("selected"),this.activeSelect.firstElementChild.innerHTML=e.innerHTML,this.activeSelect.dataset.selected=e.dataset.value,this.updateRow([e.dataset.value])}t.classList.remove("open")}}closeOpenSelect(){const e=document.querySelector(".open");e&&e.classList.remove("open")}updateRow(e){this.activeSelect.classList.contains("selectTrigger")?this.updateTrigger(this.activeSelect.parentElement.parentElement,{type:e[0]}):this.activeSelect.classList.contains("selectOption")?this.updateEntry(this.activeSelect.parentElement.parentElement.parentElement.parentElement,{type:e[0]}):this.activeSelect.classList.contains("tuyaSelect")&&this.activeSelect.parentElement.parentElement.lastElementChild.lastElementChild.classList.toggle("disabled",!e.some((e=>this.dimmableDevices.includes(e))))}saveAutomations(){const e=[];this.container.querySelectorAll(".panel").forEach((t=>{e.push({id:t.id,enabled:!t.querySelector("#enabledState").classList.contains("disabled"),trigger:this.getTrigger(t.querySelector("#trigger")),sequence:this.getSequence(t.querySelector("#sequence"))})})),this.ws.send(JSON.stringify({event:"updateAutomations",automations:e,removed:this.removedAutomations}));const t=document.querySelector(".toast");t.innerHTML="Updating Automations",t.classList.add("active"),setTimeout((()=>{t.innerHTML="Restarting Server"}),2e3),setTimeout((()=>t.classList.remove("active")),4e3)}getTrigger(e){const t=e.querySelectorAll(".input"),s=[];switch(t.forEach((e=>{e.classList.contains("select")?s.push(this.getSelected(e)):s.push(""===e.value?void 0:e.value)})),s[0][0]){case"device":return{type:s[0][0],device:s[1][0],state:"true"===s[2][0],time:s[3]};case"time":return{type:s[0][0],time:s[1]};case"sunrise":case"sunset":return{type:s[0][0],offset:this.getTime(s[1])}}}getSequence(e){const t=e.querySelectorAll(":scope>div>div>.row"),s=[];return t.forEach((e=>{const t=[];switch(e.childNodes.forEach((e=>{e.lastChild.classList.contains("select")?t.push(this.getSelected(e.lastChild)):t.push(""===e.lastChild.value?void 0:e.lastChild.value)})),t[0][0]){case"device":s.push({type:t[0][0],device:t[1],state:"true"===t[2][0],brightness:isNaN(t[3][0])?void 0:parseInt(t[3][0])});break;case"if":const a=[];e.lastChild.childNodes.forEach((e=>a.push(this.getSelected(e.lastChild)[0]))),s.push({type:t[0][0],if:{device:a[0],state:"true"===a[1]},then:this.getSequence(e.parentNode.childNodes[2])});break;case"ifElse":const i=[];e.lastChild.childNodes.forEach((e=>i.push(this.getSelected(e.lastChild)[0]))),s.push({type:t[0][0],if:{device:i[0],state:"true"===i[1]},then:this.getSequence(e.parentNode.childNodes[2]),else:this.getSequence(e.parentNode.childNodes[4])});break;case"wait":s.push({type:t[0][0],wait:this.getTime(t[1])})}})),s}getSelected(e){const t=e.dataset.selected;return""===t?[void 0]:t.split(",")}getTime(e){switch(e.slice(-1).toLowerCase()){case"s":return parseInt(e.slice(0,-1));case"m":return 60*parseInt(e.slice(0,-1));case"h":return 60*parseInt(e.slice(0,-1))*60;default:return parseInt(e)}}parseTime(e){return e%3600==0?e/3600+"h":e%60==0?e/60+"m":e?e+"s":""}parseBool(e){return!0===e?"true":!1===e?"false":void 0}},r=class{constructor(e,i,n,l){this.ws=e,this.devices=i,this.dataSet=n;const o=c("button",{class:"button solid save",id:"saveDevices"},"Save");o.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" style="height: 16px; margin-right: 8px;" fill="#FFFFFF"><path d="M433.941 129.941l-83.882-83.882A48 48 0 0 0 316.118 32H48C21.49 32 0 53.49 0 80v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V163.882a48 48 0 0 0-14.059-33.941zM272 80v80H144V80h128zm122 352H54a6 6 0 0 1-6-6V86a6 6 0 0 1 6-6h42v104c0 13.255 10.745 24 24 24h176c13.255 0 24-10.745 24-24V83.882l78.243 78.243a6 6 0 0 1 1.757 4.243V426a6 6 0 0 1-6 6zM224 232c-48.523 0-88 39.477-88 88s39.477 88 88 88 88-39.477 88-88-39.477-88-88-88zm0 128c-22.056 0-40-17.944-40-40s17.944-40 40-40 40 17.944 40 40-17.944 40-40 40z"></path></svg>Save';const d=document.createElement("div");d.append(c("button",{class:"button solid",id:"addDevice"},"Add Device"),c("button",{class:"button solid",id:"findDevices"},"Find Devices"),o);const r=c("div",{class:"panel"});r.append(c("div",{class:"row"}),c("button",{class:"button",id:"removeDevice",style:"margin-top: 15px;"},"Remove Device")),this.templates=[t("Type","Select Type",["type"],0),t("Image","Select Image",["image"],1),t("Number of Outlets","Select Number",["numoutlets"],2),t("Combine Outlets","",["combine"],3),a("Name","Enter Name",["name"]),a("Ip","Enter Ip",["ip"]),a("Key","Enter Key",["key"]),a("Id","Enter Id",["id"]),r,c("input",{type:"text",readonly:"",style:"margin: 10px 0; grid-column: 1 / -1;"}),d],this.options=[s("Select Type",this.dataSet[0]),s("Select Image",this.dataSet[1],!1,!0,l),s("Select Number",this.dataSet[2]),s("Combine",this.dataSet[3])]}setHtml(){const e=document.createDocumentFragment(),t=document.createElement("div");return t.append(...this.options),this.container=document.createElement("div"),this.removedDevices=[],this.devices.forEach((e=>{this.container.appendChild(this.createPanel(e))})),this.container.className="automation",this.container.appendChild(this.templates[10].cloneNode(!0)),e.append(this.container,t),e}handleMessage(e){if("foundDevices"===e.event){const t=document.querySelector(".toast");e.value?(t.innerText="Devices Found",setTimeout((()=>{t.innerText="Restarting Server"}),1500),setTimeout((()=>location.reload()),3e3)):(t.innerText="No Devices Found",setTimeout((()=>t.classList.remove("active")),1500))}}handleClick(e){switch(e.classList.contains("selectedOption")?(this.activeSelect=e.parentElement,this.openSelect(e.parentElement)):e.classList.contains("option")?this.handleSelectedOption(e):this.closeOpenSelect(),e.id){case"saveDevices":this.saveDevices();break;case"removeDevice":const t=e.parentElement;""!==t.id&&this.removedDevices.push(t.id),t.parentNode.removeChild(t);break;case"addDevice":this.container.insertBefore(this.createPanel(),this.container.lastChild);break;case"findDevices":this.ws.send(JSON.stringify({event:"findDevices"}));const s=document.querySelector(".toast");s.innerText="Searching for devices",s.classList.add("active")}}handleLongClick(e){}createPanel(e={type:"",id:null,name:[null],image:[null]}){const t=this.templates[8].cloneNode(!0);return t.id=e.id,t.firstChild.appendChild(this.createSelect(0,e.type)),this.updateDevice(t.firstElementChild,e),t}updateDevice(e,t){for(t.id||(t.ip=e.querySelector(".ip")?e.querySelector(".ip").value:"",t.id=e.querySelector(".id")?e.querySelector(".id").value:"",t.key=e.querySelector(".key")?e.querySelector(".key").value:"",t.name=e.querySelector(".name")?[e.querySelector(".name").value]:[""],t.image=e.querySelector(".image")?[e.querySelector(".image").dataset.selected]:[""]);e.firstChild!==e.lastChild;)e.removeChild(e.lastChild);switch(t.type){case"outlet":case"dimmer":e.append(this.createTextField(4,t.name[0]),this.createSelect(1,t.image[0]),this.createTextField(5,t.ip),this.createTextField(6,t.key),this.createTextField(7,t.id));break;case"multioutlet":e.append(this.createTextField(5,t.ip),this.createTextField(6,t.key),this.createTextField(7,t.id),this.createSelect(2,String(t.number)||""),this.createSelect(3,this.parseBool(t.combine)||"false")),this.addMultiOutlet(e,t)}}addMultiOutlet(e,t){let s;s="true"===e.childNodes[5].lastChild.dataset.selected?1:t.name.length;const a=s-(e.childElementCount-6)/3;if(a>0)for(let i=0;i<a;i++){const n=this.templates[9].cloneNode(!0);n.value="Outlet "+(s-a+i+1),e.append(n,this.createTextField(4,t.name[i]),this.createSelect(1,t.image[i]))}else for(let t=0;t<3*-a;t++)e.removeChild(e.lastChild)}createSelect(e,t){const s=this.templates[e].cloneNode(!0);return""!==t&&(s.lastElementChild.firstElementChild.innerText=this.dataSet[e][t],s.lastElementChild.dataset.selected=t),s}createTextField(e,t){const s=this.templates[e].cloneNode(!0);return s.lastElementChild.value=t,s}closeOpenSelect(){const e=document.querySelector(".open");e&&e.classList.remove("open")}openSelect(e){this.closeOpenSelect();const t=e.dataset.selected,s=this.options[parseInt(e.dataset.type)];s.childNodes.forEach((e=>{t===e.dataset.value?e.classList.add("selected"):e.classList.remove("selected")})),s.classList.add("open");const a=e.getBoundingClientRect(),i=s.clientHeight,n=window.innerHeight-a.top;s.style.left=a.left+"px",s.style.width=e.offsetWidth+"px",s.style.maxHeight=window.innerHeight-78+"px",n<i?i<window.innerHeight?s.style.top=e.offsetTop+n-i-10+"px":s.style.top="68px":s.style.top=e.offsetTop+"px"}handleSelectedOption(e){const t=e.parentElement;if(!e.classList.contains("selected")){const s=t.querySelector(".selected");if(s&&s.classList.remove("selected"),e.classList.add("selected"),this.activeSelect.firstChild.innerText=e.innerText,this.activeSelect.dataset.selected=e.dataset.value,this.activeSelect.classList.contains("type"))this.updateDevice(this.activeSelect.parentElement.parentElement,{type:e.dataset.value,id:"",name:[""],image:[""]});else if(this.activeSelect.classList.contains("numoutlets")){const t=parseInt(e.dataset.value);this.addMultiOutlet(this.activeSelect.parentElement.parentElement,{name:Array(t).fill(""),id:"",image:Array(t).fill(""),type:""})}else if(this.activeSelect.classList.contains("combine")){const e=this.activeSelect.parentElement.parentElement,t=parseInt(e.childNodes[4].lastChild.dataset.selected);this.addMultiOutlet(e,{name:Array(t).fill(""),id:"",image:Array(t).fill(""),type:""})}}t.classList.remove("open")}saveDevices(){const e=[];this.container.querySelectorAll(".panel").forEach((t=>{const s=[];if(t.querySelectorAll(".input").forEach((e=>{e.classList.contains("select")?s.push(e.dataset.selected):s.push(e.value)})),"multioutlet"===s[0]){const t=[],a=[],i=parseInt(s[4]),n="true"===s[5];if(n)t.push(s[6]),a.push(s[7]);else for(let e=0;e<i;e++)t.push(s[6+2*e]),a.push(s[7+2*e]);e.push({type:s[0],ip:s[1],key:s[2],id:s[3],name:t,image:a,number:i,combine:n})}else"outlet"!==s[0]&&"dimmer"!==s[0]||e.push({type:s[0],name:[s[1]],image:[s[2]],ip:s[3],key:s[4],id:s[5]})})),this.ws.send(JSON.stringify({event:"updateSettings",settings:e,removed:this.removedDevices}));const t=document.querySelector(".toast");t.innerText="Updating Settings",t.classList.add("active"),setTimeout((()=>{t.innerText="Restarting Server"}),2e3),setTimeout((()=>t.classList.remove("active")),2e3)}parseBool(e){return!0===e?"true":!1===e?"false":void 0}},h={sensor:{name:"Sensor",svg:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M200,128a24,24,0,0,0-24,24V264a24,24,0,0,0,48,0V152A24,24,0,0,0,200,128Zm-80,0a24,24,0,0,0-24,24V264a24,24,0,0,0,48,0V152A24,24,0,0,0,120,128ZM384,32H64A64,64,0,0,0,0,96V416a64,64,0,0,0,64,64H384a64,64,0,0,0,64-64V96A64,64,0,0,0,384,32Zm16,384a16,16,0,0,1-16,16H64a16,16,0,0,1-16-16V96A16,16,0,0,1,64,80H384a16,16,0,0,1,16,16Z"></path></svg>'},"tree-christmas":{name:"Christmas Tree",svg:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M232 256c-13.3 0-24 10.7-24 24s10.7 24 24 24 24-10.7 24-24-10.7-24-24-24zm80 96c-13.3 0-24 10.7-24 24s10.7 24 24 24 24-10.7 24-24-10.7-24-24-24zm190.1 82.8l-66.5-87c10.6-4.8 19.4-13.3 24.3-24.4 7.7-17.4 4.4-37.6-8.4-51.7L338 146.8l12.4-6.2c10.8-5.4 17.7-16.5 17.7-28.6s-6.8-23.2-17.7-28.6l-43.8-21.9-21.9-43.8C279.2 6.8 268.1 0 256 0s-23.2 6.8-28.6 17.7l-21.9 43.8-43.8 21.9C150.8 88.8 144 99.9 144 112s6.8 23.2 17.7 28.6l12.4 6.2L60.5 271.7c-12.8 14.1-16.1 34.3-8.4 51.7 4.9 11.1 13.7 19.6 24.3 24.4l-66.5 87c-11.1 14.5-13 34.1-4.9 50.4 8.1 16.4 24.8 26.7 43 26.7h416c18.3 0 34.9-10.4 43-26.7 8.1-16.3 6.2-35.9-4.9-50.4zM236.5 99.6c3.1-1.5 5.6-4.1 7.2-7.2L256 67.8l12.4 24.7c1.5 3.1 4.1 5.6 7.2 7.2l24.7 12.4-24.7 12.4c-3.1 1.5-5.6 4.1-7.2 7.2L256 156.2l-12.4-24.7c-1.5-3.1-4.1-5.6-7.2-7.2L211.8 112l24.7-12.4zM48 464l122.4-160H96l116.3-127.9 15.1 30.2c5.4 10.8 16.5 17.7 28.6 17.7s23.2-6.8 28.6-17.7l15.1-30.2L416 304h-74.4L464 464H48z"></path></svg>'},"lights-holiday":{name:"Christmas Lights",svg:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path d="M637.8 85.7l-8.1-13.9c-4.4-7.6-14.1-10-21.8-5.9-80.8 43.7-182.3 67.7-287.9 67.7S112.9 109.8 32.1 66c-7.7-4.2-17.3-1.7-21.8 5.9L2.2 85.7c-4.7 7.9-1.7 18 6.4 22.4 45.8 24.9 97.7 43.7 153 56.2l-17.9 39.3c-5.4.6-10.5 3.7-12.9 9l-9.2 20.2c-25.6-.7-49.6 12.6-65.2 46.8-21.9 48.3 4.3 129.8 17.4 135.7 13.1 6 91.8-27.9 113.7-76.1 15.6-34.2 9.8-61.1-7.7-79.8l9.2-20.2c2.4-5.3 1.4-11.2-1.7-15.6l22.8-50.1c28.1 4.3 56.8 6.9 85.8 7.8v45.2c-4.7 2.8-8 7.7-8 13.5v22.2c-23.6 9.8-40 31.8-40 69.5 0 53 57.6 116.4 72 116.4s72-63.3 72-116.4c0-37.6-16.4-59.7-40-69.5V240c0-5.9-3.3-10.8-8-13.5v-45.2c29.1-.9 57.8-3.6 85.8-7.8l22.8 50.1c-3.1 4.5-4.1 10.3-1.7 15.6l9.2 20.2c-17.5 18.7-23.2 45.5-7.7 79.8 21.9 48.3 100.6 82.1 113.7 76.1 13.1-6 39.3-87.5 17.4-135.7-15.6-34.2-39.6-47.5-65.2-46.7l-9.2-20.2c-2.4-5.3-7.5-8.4-12.9-9l-17.9-39.3c55.2-12.5 107.1-31.3 153-56.2 8.3-4.4 11.2-14.5 6.6-22.5zm-494 233.6c-6.5 14.2-26.5 29-43.9 38.6-4.3-19.4-6.3-44.2.2-58.4 9.7-21.4 18.5-22 33.3-15.2 14.8 6.7 20.2 13.6 10.4 35zm362.8-35.1c14.8-6.7 23.6-6.2 33.3 15.2 6.5 14.2 4.4 39 .2 58.4-17.4-9.6-37.4-24.4-43.9-38.6-9.8-21.3-4.4-28.2 10.4-35zM320 384.9c-11.9-15.9-24-37.7-24-53.3 0-23.5 7.7-27.6 24-27.6s24 4.1 24 27.6c0 15.6-12.1 37.4-24 53.3z"></path></svg>'},"light-ceiling":{name:"Ceiling Light",svg:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M256,512a64,64,0,0,0,64-64H192A64,64,0,0,0,256,512Zm24-350.9V0H232V161.1C112.78,172,17,263.19.32,379.62-2.43,398.81,13,416,32.56,416H479.44c19.56,0,35-17.19,32.24-36.38C495,263.19,399.22,172,280,161.1ZM51.35,368c22.13-92.42,107-160,204.65-160s182.52,67.58,204.65,160Z"></path></svg>'},"chevron-circle-right":{name:"Button",svg:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M8 256c0 137 111 248 248 248s248-111 248-248S393 8 256 8 8 119 8 256zm448 0c0 110.5-89.5 200-200 200S56 366.5 56 256 145.5 56 256 56s200 89.5 200 200zm-107.5 8.5L225.7 387.3c-4.7 4.7-12.3 4.7-17 0l-22.6-22.6c-4.7-4.7-4.7-12.3 0-17l91.7-91.7-91.7-91.7c-4.7-4.7-4.7-12.3 0-17l22.6-22.6c4.7-4.7 12.3-4.7 17 0l122.8 122.8c4.7 4.7 4.7 12.3 0 17z"></path></svg>'},"fan-table":{name:"Fan",svg:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M448,224C448,100.29,347.71,0,224,0S0,100.29,0,224C0,339.6,87.58,434.69,200,446.68V464H112c-21.32,0-41.21,13.89-47.48,33.12C62.11,504.53,68.41,512,76.2,512H371.81c7.78,0,14.08-7.47,11.67-14.88C377.22,477.89,357.32,464,336,464H248V446.68C360.42,434.69,448,339.6,448,224ZM224,400c-97,0-176-78.95-176-176S127,48,224,48s176,79,176,176S321.05,400,224,400ZM354.06,266.31a17.49,17.49,0,0,0,20.34-17.25,87.62,87.62,0,0,0-144.35-66.88L195.62,90.24c-2.57-6.85-13-15.9-25.1-9l0,0a87.06,87.06,0,0,0-40.87,53.25c-8.85,33.12,2.3,86.06,55.38,104.9l-62.65,76.1c-8.76,10.6-1.81,22.47,4.77,26.26a87.71,87.71,0,0,0,119.77-32.11,86.67,86.67,0,0,0,9.95-59.52ZM224,240a16,16,0,1,1,16-16A16,16,0,0,1,224,240Z"></path></svg>'},"door-closed":{name:"Door",svg:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path d="M624 464H512V32c0-17.67-14.33-32-32-32H160c-17.67 0-32 14.33-32 32v432H16c-8.84 0-16 7.16-16 16v16c0 8.84 7.16 16 16 16h608c8.84 0 16-7.16 16-16v-16c0-8.84-7.16-16-16-16zm-160 0H176V48h288v416zm-64-176c17.67 0 32-14.33 32-32s-14.33-32-32-32-32 14.33-32 32 14.33 32 32 32z"></path></svg>'},garage:{name:"Garage",svg:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path d="M597.91,110.08,346.31,5.29a68.1,68.1,0,0,0-52.62,0L42.09,110.08A68.11,68.11,0,0,0,0,173.2V496a16,16,0,0,0,16,16H32a16,16,0,0,0,16-16V173.2a20.18,20.18,0,0,1,12.5-18.8L312.19,49.58a20.49,20.49,0,0,1,15.72,0L579.5,154.4A20.38,20.38,0,0,1,592,173.2V496a16,16,0,0,0,16,16h16a16,16,0,0,0,16-16V173.2A68.11,68.11,0,0,0,597.91,110.08ZM504,192H136a40,40,0,0,0-40,40V496a16,16,0,0,0,16,16h16a16,16,0,0,0,16-16V352H496V496a16,16,0,0,0,16,16h16a16,16,0,0,0,16-16V232A40,40,0,0,0,504,192Zm-8,128H144V240H496ZM368,416H272a16,16,0,0,0,0,32h96a16,16,0,0,0,0-32Z"></path></svg>'},lamp:{name:"Lamp",svg:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M445.5 237.8L368 21.8C363.3 8.6 352.4 0 340.4 0H120.6c-11.4 0-21.8 7.7-27 19.9l-90.4 216c-10 23.9 4.6 52.1 27 52.1h89.2C94.7 323.1 80 366.5 80 401.6c0 32.7 12.8 64.2 36 88.7 13 13.8 31.8 21.7 51.5 21.7h113c19.7 0 38.5-7.9 51.5-21.7 23.2-24.5 36-56.1 36-88.7 0-35.1-14.7-78.5-39.4-113.6h89.2c21.7 0 36.3-26.4 27.7-50.2zM320 401.6c0 21.3-8.7 40.7-22.9 55.7-4.3 4.5-10.4 6.7-16.6 6.7h-113c-6.2 0-12.4-2.2-16.6-6.7-14.2-15-22.9-34.4-22.9-55.7 0-34.7 22.8-87.4 55.6-113.6h80.7c32.9 26.2 55.7 78.9 55.7 113.6zM53.5 240l80.4-192h192.6l68.9 192H53.5z"></path></svg>'},outlet:{name:"Outlet",svg:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M448,0H64A64,64,0,0,0,0,64V448a64,64,0,0,0,64,64H448a64,64,0,0,0,64-64V64A64,64,0,0,0,448,0Zm16,448a16,16,0,0,1-16,16H64a16,16,0,0,1-16-16V64A16,16,0,0,1,64,48H448a16,16,0,0,1,16,16ZM353.85,96H158.15a22.86,22.86,0,0,0-16.41,6.7C103.71,141.71,80,195.9,80,256s23.71,114.28,61.74,153.29A22.87,22.87,0,0,0,158.15,416h195.7a22.87,22.87,0,0,0,16.41-6.71c38-39,61.74-93.19,61.74-153.29s-23.71-114.29-61.74-153.3A22.86,22.86,0,0,0,353.85,96ZM208,272a16,16,0,0,1-16,16H176a16,16,0,0,1-16-16V192a16,16,0,0,1,16-16h16a16,16,0,0,1,16,16Zm80,80H224V336a32,32,0,0,1,64,0Zm64-80a16,16,0,0,1-16,16H320a16,16,0,0,1-16-16V192a16,16,0,0,1,16-16h16a16,16,0,0,1,16,16Z"></path></svg>'},"lamp-floor":{name:"Floor Lamp",svg:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path d="M382,212.76l-71.13-192A31.63,31.63,0,0,0,281.23,0H102.77a31.64,31.64,0,0,0-29.6,20.76L2,212.76C-5.71,233.68,9.57,256,31.64,256H168.29V464H113c-21.06,0-40.72,13.89-46.91,33.12C63.68,504.53,69.9,512,77.59,512H306.4c7.7,0,13.92-7.47,11.54-14.88C311.75,477.89,292.09,464,271,464H215.71V256H352.36C374.43,256,389.71,233.68,382,212.76ZM54.45,208,113.73,48H270.27l59.28,160Z"></path></svg>'},lightbulb:{name:"Light",svg:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 352 512"><path d="M176 80c-52.94 0-96 43.06-96 96 0 8.84 7.16 16 16 16s16-7.16 16-16c0-35.3 28.72-64 64-64 8.84 0 16-7.16 16-16s-7.16-16-16-16zM96.06 459.17c0 3.15.93 6.22 2.68 8.84l24.51 36.84c2.97 4.46 7.97 7.14 13.32 7.14h78.85c5.36 0 10.36-2.68 13.32-7.14l24.51-36.84c1.74-2.62 2.67-5.7 2.68-8.84l.05-43.18H96.02l.04 43.18zM176 0C73.72 0 0 82.97 0 176c0 44.37 16.45 84.85 43.56 115.78 16.64 18.99 42.74 58.8 52.42 92.16v.06h48v-.12c-.01-4.77-.72-9.51-2.15-14.07-5.59-17.81-22.82-64.77-62.17-109.67-20.54-23.43-31.52-53.15-31.61-84.14-.2-73.64 59.67-128 127.95-128 70.58 0 128 57.42 128 128 0 30.97-11.24 60.85-31.65 84.14-39.11 44.61-56.42 91.47-62.1 109.46a47.507 47.507 0 0 0-2.22 14.3v.1h48v-.05c9.68-33.37 35.78-73.18 52.42-92.16C335.55 260.85 352 220.37 352 176 352 78.8 273.2 0 176 0z"></path></svg>'},speakers:{name:"Speakers",svg:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path d="M448 176a48 48 0 1 0-48-48 48 48 0 0 0 48 48zm0 256a112 112 0 1 0-112-112 112 112 0 0 0 112 112zm0-176a64 64 0 1 1-64 64 64 64 0 0 1 64-64zM592 0H304a48 48 0 0 0-48 48v416a48 48 0 0 0 48 48h288a48 48 0 0 0 48-48V48a48 48 0 0 0-48-48zm0 464H304V48h288zM224 92.46a48 48 0 1 0 0 71.08zM192 256a63.33 63.33 0 0 1 32 8.88V213.2c-10.2-3.06-20.8-5.2-32-5.2a112 112 0 0 0 0 224c11.2 0 21.8-2.14 32-5.2v-51.68a63.33 63.33 0 0 1-32 8.88 64 64 0 0 1 0-128zM240.41 0H48A48 48 0 0 0 0 48v416a48 48 0 0 0 48 48h192.41A79.24 79.24 0 0 1 224 464H48V48h176a79.24 79.24 0 0 1 16.41-48z"></path></svg>'}},p=document.querySelector("#app");let u,m,v,g,f,y;function S(){for(;p.hasChildNodes();)p.removeChild(p.lastChild);y=f.find((e=>e.path===location.pathname)).view,y||(y=f[0].view),p.appendChild(y.setHtml())}function w(){const e={},t={};return v.states.forEach((s=>{e[s.id]=s.name,"dimmer"!==s.type&&"multioutlet"!==s.type&&"outlet"!==s.type||(t[s.id]=s.name)})),[e,t,{device:"Device",time:"Time",sunset:"Sunset",sunrise:"Sunrise"},{device:"Device",if:"If",ifElse:"If else",wait:"Wait"},{100:"10%",200:"20%",300:"30%",400:"40%",500:"50%",600:"60%",700:"70%",800:"80%",900:"90%",1e3:"100%"},{true:"Turns On",false:"Turns Off"},{true:"Is On",false:"Is Off"},{true:"Turn On",false:"Turn Off"}]}function C(){const e={};for(let t in h)e[t]=h[t].name;return[{dimmer:"Dimmer",multioutlet:"Multi Outlet",outlet:"Outlet"},e,{1:"1",2:"2",3:"3",4:"4",5:"5"},{true:"Yes",false:"No"}]}window.addEventListener("popstate",S),document.addEventListener("DOMContentLoaded",(()=>{let e=!1,t=!1;document.addEventListener("pointerout",(()=>{e=!1,t&&clearTimeout(m)})),document.addEventListener("pointerup",(s=>{e&&(e=>{const t=e.target;var s;t.matches("[data-link]")&&(e.preventDefault(),s=t.href,history.pushState(null,null,s),S(),M()),"mode"===t.id?t.lastElementChild.classList.toggle("active"):null!==t.parentElement&&"modeOptions"===t.parentElement.id?(document.body.className=t.id,u.send(JSON.stringify({event:"updateMode",mode:t.id}))):document.getElementById("modeOptions").classList.toggle("active",!1),y.handleClick(t)})(s),e=!1,t=!1,clearTimeout(m)})),document.addEventListener("pointerdown",(s=>{e=!0,t=!0,m=setTimeout((()=>{y.handleLongClick(s.target)}),500)}),!0)})),function e(){u=new WebSocket(location.origin.replace(/^http/,"ws")),u.onopen=()=>console.log("WebSocket Connected."),u.onclose=()=>{setTimeout(e,1e4)},u.onmessage=e=>{if(function(e){try{return JSON.parse(e),!0}catch(e){return!1}}(e.data)){const t=JSON.parse(e.data);if(console.log(t),t.hasOwnProperty("type")){let e=v.states.findIndex((e=>e.id===t.id));for(let s in t)v.states[e][s]=t[s]}"homeData"===t.event?(v=t.data,f=[{path:"/",view:new o(u,v.states,g.layout,h)},{path:"/automations",view:new d(u,v.automations,w(),v.states.filter((e=>"dimmer"===e.type)).map((e=>e.id)))},{path:"/settings",view:new r(u,v.devices,C(),h)}],S(),H()):"reload"===t.event?location.reload():"userData"===t.event?g=t.data:"updateLayout"===t.event?g.layout=t.layout:y.handleMessage(t)}}}();const L=document.getElementById("snowContainer"),E=document.createElement("div");E.classList.add("snowflake"),E.innerText="❆";const b=[],x=[],T=[],H=()=>{for(let e=0;e<10;e++){x.push(10*e+"%"),T.push(1*e+"s, "+10*-Math.random()+"s");const t=E.cloneNode(!0);b.push(t)}b.forEach((e=>{const t=x.splice(Math.floor(Math.random()*x.length),1)[0],s=T.splice(Math.floor(Math.random()*T.length),1)[0];e.style.animationDelay=s,e.style.left=t})),L.append(...b)},M=()=>{const e=Math.max(window.innerHeight,p.clientHeight),t=e/window.innerHeight*10+"s, 4s";L.style.height=e+"px",b.forEach((e=>e.style.animationDuration=t))}})();